pipeline {
    agent any
    stages {
        stage('environment variables') {
            steps {
                sh 'printenv'
                sh 'ls -la'
            }
        }
        stage('Verify Code Quality') {

            stages {
                stage('Get PullRequestNumber') {
                    steps {
                        script {
                            echo "PR Has been opened: ${env.pullRequestNumber}"
                        }
                    }
                }

                stage('Setup') {
                    steps {
                        sh "poetry install --with dev"
                    }
                }

                stage('Test') {
                    steps {
                        sh "poetry run pytest"
                    }
                }
            }
        }      
    }
}